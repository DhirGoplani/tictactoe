<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Tic Tac Toe â€” PvC (Easy)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Tic Tac Toe</h1>

  <div id="playerInfo">
    <span>You: <strong id="playerChar">X</strong></span>
    <span style="margin-left:16px">Computer: <strong id="aiChar">O</strong></span>
  </div>

  <div id="board" aria-live="polite"></div>
  <div id="status"></div>
  <div id="score">You: 0 | Computer: 0</div>

  <div id="buttons">
    <button id="toggleTheme">Toggle Dark/Light</button>
    <button id="reset">Reset</button>
    <button id="back" class="small">Back to Menu</button>
  </div>

<script>
  const themeBtn = document.getElementById('toggleTheme');
  function applyTheme(){ if(localStorage.getItem('ttt-theme')==='dark') document.body.classList.add('dark'); themeBtn.textContent = document.body.classList.contains('dark') ? 'Switch to Light' : 'Switch to Dark'; }
  applyTheme();
  themeBtn.addEventListener('click', ()=> { document.body.classList.toggle('dark'); localStorage.setItem('ttt-theme', document.body.classList.contains('dark') ? 'dark' : 'light'); themeBtn.textContent = document.body.classList.contains('dark') ? 'Switch to Light' : 'Switch to Dark'; });
  const board = document.getElementById('board');
  const status = document.getElementById('status');
  const playerCharEl = document.getElementById('playerChar');
  const aiCharEl = document.getElementById('aiChar');
  const resetBtn = document.getElementById('reset');
  const backBtn = document.getElementById('back');
  const scoreBoard = document.getElementById('score');
  let gameCount = 0;
  let playerChar = 'X';
  let aiChar = 'O';
  let currentTurn = 'X';
  let gameOver = false;
  let cells = Array(9).fill('');
  let playerScore = 0;
  let aiScore = 0;
  let centerTimeout = null;
  function updateCharsFromGameCount(){
    if ((gameCount & 1) === 0) {
      playerChar = 'X';
      aiChar = 'O';
    } else {
      playerChar = 'O';
      aiChar = 'X';
    }
    playerCharEl.textContent = playerChar;
    aiCharEl.textContent = aiChar;
  }
  function createBoard(){
    board.innerHTML = '';
    for(let i=0;i<9;i++){
      const cell = document.createElement('div');
      cell.className = 'box';
      cell.dataset.index = i;
      cell.textContent = cells[i];
      cell.addEventListener('click', onCellClick);
      board.appendChild(cell);
    }
  }
  function onCellClick(e){
    const idx = Number(e.target.dataset.index);
    if (gameOver || cells[idx] !== '' || currentTurn !== playerChar) return;
    makeMove(idx, playerChar);
    if (!gameOver && currentTurn === aiChar) {
      setTimeout(()=> aiMakeRandomMove(), 180);
    }
  }
  function makeMove(idx, ch){
    if (typeof idx !== 'number' || idx < 0 || idx > 8) return;
    cells[idx] = ch;
    const box = document.querySelector(`.box[data-index="${idx}"]`);
    if (box) box.textContent = ch;
    checkWinner();
    if (!gameOver) currentTurn = currentTurn === 'X' ? 'O' : 'X';
    else updateResetButton();
  }
  function aiMakeRandomMove(){
    if (gameOver) return;
    const empties = cells.map((v,i)=> v===''?i:null).filter(v => v !== null);
    if (empties.length === 0) return;
    const pick = empties[Math.floor(Math.random()*empties.length)];
    makeMove(pick, aiChar);
  }
  function checkWinner(){
    const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    for (const [a,b,c] of wins){
      if (cells[a] && cells[a] === cells[b] && cells[b] === cells[c]){
        gameOver = true;
        const winner = cells[a];
        status.textContent = (winner === playerChar ? 'You win!' : 'Computer wins!');
        if (winner === playerChar) playerScore++; else aiScore++;
        updateScore();
        document.querySelectorAll('.box')[a].classList.add('winning');
        document.querySelectorAll('.box')[b].classList.add('winning');
        document.querySelectorAll('.box')[c].classList.add('winning');
        return;
      }
    }
    if (!cells.includes('')){
      gameOver = true;
      status.textContent = "It's a draw!";
    }
  }

  function updateScore(){ scoreBoard.textContent = `You: ${playerScore} | Computer: ${aiScore}`; }
  function updateResetButton(){
    resetBtn.textContent = gameOver ? 'New Game' : 'Reset';
  }
  function startNewGame(){
    updateCharsFromGameCount();
    cells = Array(9).fill('');
    gameOver = false;
    status.textContent = '';
    createBoard();
    document.querySelectorAll('.box').forEach(b=> b.classList.remove('winning'));
    updateResetButton();
    if(playerChar === 'X'){
      currentTurn = 'X';
      board.style.pointerEvents = 'auto';
    }
    else{
      currentTurn = 'O';
      board.style.pointerEvents = 'none';
      if (centerTimeout) clearTimeout(centerTimeout);
      centerTimeout = setTimeout(()=>{
        if (!gameOver && cells[4] === ''){
          cells[4] = aiChar;
          const center = document.querySelector('.box[data-index="4"]');
          if (center) center.textContent = aiChar;
          checkWinner();
        }
        board.style.pointerEvents = 'auto';
        updateResetButton();
      }, 200);
    }
  }
  resetBtn.addEventListener('click', ()=>{
    gameCount++;
    startNewGame();
  });

  backBtn.addEventListener('click', ()=> location.href = 'index.html');
  startNewGame();
  document.addEventListener('keydown', e=>{
    if (e.key === 'r' || e.key === 'R'){
      gameCount++;
      startNewGame();
    }
  });
</script>
</body>
</html>
